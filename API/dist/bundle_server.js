(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var s in a)e.o(a,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:a[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=require("express");var a=e.n(t);const s=require("cors");var n=e.n(s);const o=require("request");var r=e.n(o);const i=a()();function c(e){return new Promise((function(t,a){r().get({url:e,json:!0,headers:{"User-Agent":"request"}},((e,s,n)=>{e?(a(e),console.log("error:",e)):200!==s.statusCode?console.log("Status:",s.statusCode):t(n)}))}))}async function l(e,t){let a=`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${e}&apikey=546M72GB5ZUMCF4H`;return"wait"==t?new Promise((function(e,t){setTimeout((async function(){e(await c(a))}),15e3)})):await c(a)}i.get("/",(function(e,t){t.send('<!DOCTYPE html>\n    <html lang="en">\n    <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>Servidor</title>\n    </head>\n        <body>\n           Rodando ...\n        </body>\n    </html>')})),i.get("/stocks/:stock_name/quote",(async function(e,t){const{stock_name:a}=e.params;let s=`https://www.alphavantage.co/query?function=SYMBOL_SEARCH&keywords=${a}&apikey=CPU4KCW6RXDDUY2L`,n=await c(s);if(0==n.bestMatches.length)return t.status(404),void t.send({error:"Empresa não encontrada"});let o=await l(n.bestMatches[0]["1. symbol"]);try{t.status(200),t.send({name:n.bestMatches[0]["1. symbol"],lastPrice:parseFloat(o["Global Quote"]["05. price"]),pricedAt:new Date(o["Global Quote"]["07. latest trading day"])})}catch{t.status(404),t.send({error:"Limite de solicitação excedida"})}})),i.get("/stocks/:stock_name/history",(async function(e,t){const{stock_name:a}=e.params;let s=new Date(e.query.from),n=new Date(e.query.to);if(s>n)return t.status(403),void t.send({error:"Data final menor que a inicial"});let o=`https://www.alphavantage.co/query?function=SYMBOL_SEARCH&keywords=${a}&apikey=CPU4KCW6RXDDUY2L`,r=await c(o);if(0==r.bestMatches.length)return t.status(404),void t.send({error:"Empresa não encontrada"});o=`https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${r.bestMatches[0]["1. symbol"]}&apikey=CPU4KCW6RXDDUY2L`;let i=await c(o),l=new Array;for(;s<=n;)s.setDate(s.getDate()+1),l.push(s.toLocaleDateString("zh-Hans-CN",{year:"numeric",month:"2-digit",day:"2-digit"}));let u=new Array;l.forEach((e=>{i["Time Series (Daily)"][e]&&u.push({opening:parseFloat(i["Time Series (Daily)"][e]["1. open"]),low:parseFloat(i["Time Series (Daily)"][e]["3. low"]),high:parseFloat(i["Time Series (Daily)"][e]["2. high"]),closing:parseFloat(i["Time Series (Daily)"][e]["4. close"]),pricedAt:e})})),t.status(200),t.send({name:r.bestMatches[0]["1. symbol"],prices:u})})),i.post("/stocks/:stock_name/compare",(async function(e,t){const{stock_name:a}=e.params;let s=e.body.stocks;s.push(a);let n=new Array;for(var o=0;o<s.length;o++){let e=`https://www.alphavantage.co/query?function=SYMBOL_SEARCH&keywords=${s[o]}&apikey=CPU4KCW6RXDDUY2L`,t=await c(e);if(0!=t.bestMatches.length){let e=await l(t.bestMatches[0]["1. symbol"],"wait");n.push({name:t.bestMatches[0]["1. symbol"],lastPrice:parseFloat(e["Global Quote"]["05. price"]),pricedAt:e["Global Quote"]["07. latest trading day"]})}}if(0==n.length)return t.status(404),void t.send({error:"Nenhuma empresa encontrada"});t.status(200),t.send({lastPrices:n})})),i.get("/stocks/:stock_name/gains",(async function(e,t){const{stock_name:a}=e.params;let s=parseInt(e.query.purchasedAmount),n=e.query.purchasedAt,o=`https://www.alphavantage.co/query?function=SYMBOL_SEARCH&keywords=${a}&apikey=CPU4KCW6RXDDUY2L`,r=await c(o);if(0==r.bestMatches.length)return t.status(404),void t.send({error:"Empresa não encontrada"});let i=await l(r.bestMatches[0]["1. symbol"]);o=`https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${r.bestMatches[0]["1. symbol"]}&outputsize=full&apikey=546M72GB5ZUMCF4H`;let u=await c(o);try{t.status(200),t.send({name:r.bestMatches[0]["1. symbol"],purchasedAmount:s,purchasedAt:n,priceAtDate:parseFloat(u["Time Series (Daily)"][n]["4. close"]),lastPrice:parseFloat(i["Global Quote"]["05. price"]),capitalGains:parseFloat(i["Global Quote"]["05. price"])*s-parseFloat(u["Time Series (Daily)"][n]["4. close"])*s})}catch{t.status(404),t.send({error:"Data não disponivel"})}}));const u=i,p=a()();p.use(a().json()),p.use(a().urlencoded({extended:!0})),p.use(a().static("dist/public")),p.use(n()()),p.use(u),p.listen(3030,(function(){console.log("Servidor esta ouvindo na porta 3030")}))})();